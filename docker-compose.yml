# Docker Compose for local development
# Runs fly-worker container that polls Redis for jobs

services:
  fly-worker:
    build:
      context: ./fly
      dockerfile: Dockerfile
    container_name: tcoder-fly-worker
    env_file:
      - .env
    environment:
      # Override webhook URL to reach host machine
      - WEBHOOK_URL=http://host.docker.internal:8787/webhooks/job-complete
      # Local dev machine ID
      - FLY_MACHINE_ID=local-dev-worker
    extra_hosts:
      - "host.docker.internal:host-gateway"
    # Restart automatically to keep polling for jobs
    restart: unless-stopped
